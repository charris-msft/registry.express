# MCP Registry Express - AI Agent Instructions

This document provides instructions for AI agents (GitHub Copilot, Claude, etc.) working with this codebase.

## Project Overview

MCP Registry Express is a simplified MCP (Model Context Protocol) Registry designed for private/self-hosted scenarios. It stores MCP server definitions as JSON files and generates a static API compatible with the official MCP Registry.

## Architecture

```
User adds/edits JSON files in servers/
         ↓
GitHub Action runs npm run build
         ↓
Build script aggregates to dist/api/
         ↓
Static site serves API endpoints
```

## File Formats

The registry supports two JSON formats:

### Single Server Format
One server per file, simple and direct:
```json
{
  "$schema": "https://static.modelcontextprotocol.io/schemas/2025-10-17/server.schema.json",
  "name": "io.github.user/my-server",
  "description": "...",
  "versions": [...]
}
```

### Multi-Server Format
Multiple servers in one file, useful for organization:
```json
{
  "$schema": "https://static.modelcontextprotocol.io/schemas/2025-10-17/server.schema.json",
  "servers": [
    { "name": "io.github.user/server-one", "description": "...", "versions": [...] },
    { "name": "io.github.user/server-two", "description": "...", "versions": [...] }
  ]
}
```

## Task: Add a New MCP Server

When a user asks to add an MCP server:

1. **Determine the server details**:
   - Name (reverse-DNS format with one slash, e.g., `io.github.user/server-name`)
   - Description
   - Repository URL
   - Package registry (npm, pypi, oci, etc.)
   - Package identifier
   - Transport type (usually "stdio")

2. **Choose file location**:
   - New single-server file: `servers/{namespace}/{server-name}.json`
   - Add to existing multi-server file: check if user has a preferred file
   - Create new multi-server file: `servers/{category}.json`

3. **Use this template for single server**:
```json
{
  "$schema": "https://static.modelcontextprotocol.io/schemas/2025-10-17/server.schema.json",
  "name": "NAMESPACE/SERVER_NAME",
  "description": "DESCRIPTION",
  "repository": {
    "url": "REPO_URL",
    "source": "github"
  },
  "versions": [
    {
      "version": "VERSION",
      "releaseDate": "YYYY-MM-DD",
      "isLatest": true,
      "packages": [
        {
          "registryType": "REGISTRY_TYPE",
          "identifier": "PACKAGE_ID",
          "runtimeHint": "RUNTIME",
          "transport": {
            "type": "stdio"
          }
        }
      ]
    }
  ]
}
```

4. **Or add to multi-server file**:
   - Read existing file
   - Add new server object to the `servers` array
   - Keep $schema at the top level

## Task: Import from Official Registry

When a user wants to import a server from the official MCP Registry:

```bash
# Import latest version (creates single-server file)
npm run cli import "io.github.user/server-name"

# Import all versions
npm run cli import "io.github.user/server-name" --all-versions

# Import into a specific file (multi-server format)
npm run cli import "io.github.user/server-name" --file servers/my-favorites.json

# Search first if unsure of exact name
npm run cli search "keyword"
```

## Task: Update an Existing Server

1. Find the file containing the server (could be single or multi-server format)
2. Add a new version object to the `versions` array
3. Set `isLatest: true` on the new version
4. Set `isLatest: false` on the previous latest version

## Task: Remove a Server

- **Single-server file**: Delete the JSON file
- **Multi-server file**: Remove the server object from the `servers` array

## Validation Rules

- **Name**: Must match pattern `^[a-z][a-z0-9-]*(\.[a-z][a-z0-9-]*)*/[a-z][a-z0-9-]*$`
- **Version**: Semantic versioning preferred (e.g., `1.0.0`, `2.1.0-beta.1`)
- **Registry Types**: `npm`, `pypi`, `oci`, `nuget`, `mcpb`
- **Runtime Hints**: `npx`, `docker`, `dnx`, `python`, `uvx`, `binary`
- **Transport Types**: `stdio`, `streamable-http`, `sse`

## Environment Variables

For servers requiring configuration, document them:

```json
"environmentVariables": [
  {
    "name": "API_KEY",
    "description": "API key for the service",
    "required": true
  }
]
```

## Common Namespaces

- `io.github.{username}` - GitHub users/orgs
- `com.{company}` - Companies (e.g., `com.microsoft`)
- `io.modelcontextprotocol` - Official MCP servers

## File Organization Options

Users can organize `servers/` however they prefer:
- By namespace: `servers/io.github.user/server.json`
- By category: `servers/databases/all.json`
- All-in-one: `servers/registry.json`
- Mixed: Any combination of the above

The build system recursively finds all `.json` files in `servers/`.

## Files to Never Edit Directly

- `dist/*` - Generated by build process
- `node_modules/*` - Dependencies

## Files You Can Edit

- `servers/**/*.json` - Server definitions
- `schemas/*.json` - Schema files (if extending)
- `src/**/*.js` - Source code
- `.github/workflows/*.yml` - CI/CD configuration
